<!DOCTYPE HTML>
<html>
<head>
	<title>新增客户</title>
	<meta name="description" content=""/>
	<meta name="keywords" content=""/>
	<meta http-equiv="content-type" content="text/html; charset=UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
	<!-- 加载当前项目专用css js -->
	<script type="text/javascript" src="../lib/jquery-3.1.0.min.js"></script>
	<link type="text/css" href="css/custom.css" rel="stylesheet">
</head>

<body>
	<div class="top_bar">
		<input class="back" type="button" value="返回" onclick="history.go(-1)"/>
		新增客户
	</div>
	<ul id="customs">
		<div id="custom">
			<li class="cunstom">
				<div class="cus_info">
					<span>客户: <input type="text" id="cname"/></span>
					<span>电话: <input type="number" id="tel_num"/></span>
				</div>
				<div class="cus_info">
					<span>目标: <input type="text" id="goal_fang"/></span>
					<span>行业: <input type="text" id="job"/></span>
				</div>
				<div class="cus_info">
					<span>面积: <input type="number" id="size"/></span>
					<span>预算: <input type="number" id="price"/></span>
				</div>
				<div class="cus_info">
					<span>到期时间: <input type="date" id="deadline" /></span>
					<span>搬迁原因: <input type="text" id="reason"/></span>
				</div>
				<div class="contact_item">
					<span class="tt">当前地址</span>
					<input type="text" id="now_address"/>
				</div>	
				<div class="contact_item">
					<span class="tt">其他</span>
					<textarea id="other_mark" rows="6"></textarea>
				</div>	
				<div class="contact_item">
					<span class="tt">分配业务员</span>
					<select id="salesman" style="width:40%;" onchange="setSalesman(this.options[this.options.selectedIndex].value)"></select>				
				</div>							
			</li>			
		</div>
	</ul>
	<div class="menu_bar">
		<span onclick="addCustom();">确定</span>
	</div>

	<script id="salesman-template" type="text/x-dot-template">
		{{ for(var i in it) { }}
			<option value="{{=it[i]._id}}">{{=it[i].nick_name}}</option>
		{{ } }}
	</script>		
</body>
</html>
<script type="text/javascript" src="../lib/common.js"></script>
<script type="text/javascript" src="../lib/doT.min.js"></script>
<script type="text/javascript">	
	var salesman = 1;

	function setSalesman(s){
		salesman = s;
	}
	function addCustom(){
		var cname = $("#cname").val(),
			tel_num = $("#tel_num").val(),
			goal_fang = $("#goal_fang").val(),
			size = $("#size").val(),
		    price = $("#price").val(),
			deadline = $("#deadline").val(),
		    reason = $("#reason").val(),
		 	job = $("#job").val(), 
			now_address = $("#now_address").val(),
			other_mark = $("#other_mark").val();

		if(check(cname) && check(tel_num) && check(goal_fang) && check(size)
		&& check(price) && check(deadline) && check(reason) && check(salesman)){
			var params = {
				cname: cid,
				tel_num: ctime,
				goal_fang: constatus,
				size: detail,
				price: cid,
				deadline: ctime,
				reason: constatus,
				salesman: salesman,
				job: job,
				now_address: now_address,
				other_mark: other_mark
			}
			$.ajax({
	            type: "post",
	            url: _dirname + '/system/admin/addCustom',
	            data: params,
	            dataType: "json",
	            success: function(data){
	            	alert(data.desc);
	            }
	        });				
		}else{
			alert('请输入完整信息');
		}		
	}

	$.ajax({
        type: "get",
        url: _dirname + '/system/admin/getSalesman',
        dataType: "json",
        success: function(data){
        	try{
	        	if(data.code == 1){
					var tpl = $("#salesman-template").text();
					var tempFn = doT.template(tpl);
					var rHtml = tempFn(data.salesmans);
					$("#salesman").html(rHtml);		      		
	        	}else{
	        		alert('信息错误');
	        	}
	        }catch(e){
	        	alert('数据出错，稍后再试');
	        }
        }
    });		    

</script>

